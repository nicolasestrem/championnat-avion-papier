---
/**
 * Renders a page displaying all blog posts for a specific category.
 *
 * This is a dynamic route that generates a static page for each unique
 * category found in the 'blog' content collection. The category is
 * determined by the `category` URL parameter.
 *
 * @page
 * @see src/layouts/Layout.astro
 * @see src/components/BlogCard.astro
 * @see src/utils/slugify.ts
 */
import { getCollection } from 'astro:content';
import Layout from '../../../layouts/Layout.astro';
import Header from '../../../components/Header.astro';
import Footer from '../../../components/Footer.astro';
import BlogCard from '../../../components/BlogCard.astro';
import { slugify } from '../../../utils/slugify';

/**
 * Generates static paths for each unique blog post category.
 *
 * This function is required for dynamic routes in Astro's static site generation.
 * It finds all unique categories across all blog posts, creates a slug for each,
 * and generates a page for that slug. It passes the original category name and
 * the filtered posts as props to the component.
 *
 * @returns {Promise<Array<object>>} An array of objects defining the paths and props for each category page.
 */
export async function getStaticPaths() {
  const posts = await getCollection('blog');
  const categories = [...new Set(posts.map((post) => post.data.category))];

  return categories.map((category) => {
    const categorySlug = slugify(category);
    return {
        params: { category: categorySlug },
        props: {
            category,
            posts: posts.filter(post => slugify(post.data.category) === categorySlug)
        },
    }
  });
}

/**
 * The props for this page.
 * @typedef {object} Props
 * @property {string} category - The name of the category.
 * @property {import('astro:content').CollectionEntry<'blog'>[]} posts - An array of posts belonging to this category.
 */
const { category, posts } = Astro.props;

const sortedPosts = posts.sort((a, b) =>
  b.data.publishDate.valueOf() - a.data.publishDate.valueOf()
);
---

<Layout title={`Articles - Catégorie: ${category} - Championnat du Monde de Lancer d'Avions en Papier`}>
  <Header />

  <main>
    <!-- Hero Section -->
    <section class="py-16 bg-gradient-to-br from-blue-600 to-blue-800 text-white">
      <div class="container">
        <h1 class="text-4xl md:text-5xl font-bold mb-4">Catégorie: {category}</h1>
        <p class="text-xl max-w-3xl">
          Articles et tutoriels dans la catégorie "{category}"
        </p>
      </div>
    </section>

    <!-- Blog Posts Grid -->
    <section class="py-16">
      <div class="container">
        {sortedPosts.length === 0 ? (
          <p class="text-center text-gray-600 text-lg">
            Aucun article disponible dans cette catégorie.
          </p>
        ) : (
          <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-8">
            {sortedPosts.map((post) => (
              <BlogCard post={post} />
            ))}
          </div>
        )}
      </div>
    </section>

    <div class="text-center mb-16">
        <a
        href="/blog"
        class="inline-flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white font-semibold px-6 py-3 rounded-lg transition-colors"
        >
        Retour à tous les articles
        </a>
    </div>
  </main>

  <Footer />
</Layout>